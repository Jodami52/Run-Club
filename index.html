<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Running Data Visualization</h1>
    <canvas id="runningChart" width="400" height="200"></canvas>
    <script>
        async function fetchData() {
            const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQ6zFlmP8dSQAAWgqs-9UQcjrCRUxmPlLj3_T-iYnZYhXpDtgfz3KkCcK5IWTTfsfAMQ_QzBCNVyEPu/pub?gid=0&single=true&output=csv');
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            const labels = [];
            const runners = {};
            
            rows.forEach(row => {
                const cols = row.split(',');
                const date = cols[0];
                const runner = cols[1];
                const distance = parseFloat(cols[2]);

                if (!labels.includes(date)) {
                    labels.push(date);
                }

                if (!runners[runner]) {
                    runners[runner] = [];
                }

                runners[runner].push({ date, distance });
            });

            return { labels, runners };
        }

        async function createChart() {
            const data = await fetchData();
            const ctx = document.getElementById('runningChart').getContext('2d');
            const datasets = Object.keys(data.runners).map(runner => {
                const distances = data.labels.map(label => {
                    const run = data.runners[runner].find(r => r.date === label);
                    return run ? run.distance : 0;
                });

                return {
                    label: runner,
                    data: distances,
                    backgroundColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.2)`,
                    borderColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`,
                    borderWidth: 1
                };
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: datasets
                },
                options: {
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Distance Run (miles)'
                            }
                        }
                    }
                }
            });
        }

        createChart();
    </script>
</body>
</html>
